language: android
jdk: oraclejdk8
sudo: false

env:
  global:
    - GRADLE_USER_HOME=${TRAVIS_BUILD_DIR}/gradle
    - ANDROID_HOME=${TRAVIS_BUILD_DIR}/android-sdk
    - SDK=${TRAVIS_BUILD_DIR}/android-sdk
    - PATH=${GRADLE_USER_HOME}/bin/:${SDK}/:${SDK}/tools/:${SDK}/platform-tools/:${PATH}
    - ANDROID_TARGET=android-25
    - ANDROID_ABI=armeabi-v7a

android:
  components:
    # Uncomment the lines below if you want to
    # use the latest revision of Android SDK Tools
    # The double 'tools' is intended. It causes the latest list of
    # androids to be downloaded and then the latest to be installed.
    - tools
    - tools
    - platform-tools
    - build-tools-25.0.2


    # The BuildTools version used by your project
    # - build-tools-25.0.2

    # The SDK version used to compile your project
    - android-25

    # Additional components
    # - extra-google-m2repository # Google play service
    - extra-android-m2repository # Design support library
    # - addon-google_apis-google-19

    # Specify at least one system image,
    # if you need to run emulator(s) during your tests
    # - sys-img-armeabi-v7a-addon-google_apis-google-25
    # - sys-img-${ANDROID_ABI}-${ANDROID_TARGET}

  licenses:
    - 'android-sdk-license-.+'
    - 'google-gdk-license-.+'

# Move into the project folder
# before_script: cd BankChain
before_install:
  - cd BankChain

# install:
#   - echo y | android update sdk -u -a -t tools
#   - echo y | android update sdk -u -a -t platform-tools
#   - echo y | android update sdk -u -a -t build-tools-25.0.2
#   - echo y | android update sdk -u -a -t android-25
#   - echo y | android update sdk -u -a -t extra-google-google_play_services
#   - echo y | android update sdk -u -a -t extra-google-m2repository
#   - echo y | android update sdk -u -a -t extra-android-m2repository
#   - echo y | android update sdk -u -a -t addon-google_apis-google-19

# install:
#   - echo y | android update sdk -u -a -t tools
#   - echo y | android update sdk -u -a -t platform-tools
#   - echo y | android update sdk -u -a -t build-tools-25.0.2
#   - echo y | android update sdk -u -a -t android-25
#   - echo y | android update sdk -u -a -t extra-google-m2repository
#   - echo y | android update sdk -u -a -t extra-android-m2repository

# before_script:
#   # Create and start emulator
#   - echo no | android create avd --force -n test -t $ANDROID_TARGET --abi $ANDROID_ABI
#   - emulator -avd test -no-skin -no-audio -no-window &
#   - android-wait-for-emulator
#   - adb shell input keyevent 82 &

before_script:
  - echo y | android update sdk --no-ui --all --filter platform-tools,android-25,extra-android-m2repository

# # Run tests
script:
#   - ./gradlew connectedAndroidTest
  - ./gradlew build connectedCheck

# Caching for speeding up builds
before_cache:
  - rm -f  $HOME/BankChain/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/BankChain/.gradle/caches/*/plugin-resolution/

cache:
  apt: true
  directories:
    - $HOME/BankChain/.gradle/caches/
    - $HOME/BankChain/.gradle/wrapper/
    - $HOME/BankChain/.android/build-cache
    - ${TRAVIS_BUILD_DIR}/gradle/caches/
    - ${TRAVIS_BUILD_DIR}/gradle/wrapper/dists/
    - ${TRAVIS_BUILD_DIR}/android-sdk/extras/
